local hJvXJe = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
local JimQGH = hJvXJe.CreateLib("Soka Hub", "DarkTheme")

-- Services
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local AshpTz = Players.AshpTz
local gPpjzL = workspace.CurrentCamera
local UserInputService = game:GetService("UserInputService")

-- Global table for all GxMLsa
local GxMLsa = {}

-- States
local GbjUbX = false
local vGHSMH = false
local hXWelD = false
local xDXXPV = 1         -- Default horizontal speed from slider (change as needed)
local eupSbP = 50
local NSZBOf = 100
local ULQIud = false
local OVoMBv = true
local GmdpEU = {}
local qWRmtT = {}
local bGuZKS = Color3.new(1, 0, 0)

-- Main Tab
local hKMlQd = JimQGH:NewTab("Main")
local TemOpX = hKMlQd:NewSection("Speed")
local xvggGP = hKMlQd:NewSection("Flight")
local FobjdJ = hKMlQd:NewSection("Dash")
local aMfoeB = hKMlQd:NewSection("Misc")

-- Speed Toggle with smooth horizontal PCOmob update (preserves vertical PCOmob)
TemOpX:NewKeybind("Speed Toggle", "Toggle speed with key", Enum.KeyCode.X, function()
    vGHSMH = not vGHSMH
    if vGHSMH then
        local kWcWwx = RunService.Heartbeat:Connect(function()
            if AshpTz.Character and vGHSMH then
                local OudALc = AshpTz.Character:FindFirstChild("HumanoidRootPart")
                local hBtlbh = AshpTz.Character:FindFirstChild("Humanoid")
                if OudALc and hBtlbh then
                    local pTMSgh = hBtlbh.MoveDirection
                    local PrriGz = OudALc.Velocity
                    local uQSnBM = Vector3.new(pTMSgh.X * xDXXPV, PrriGz.Y, pTMSgh.Z * xDXXPV)
                    OudALc.Velocity = PrriGz:Lerp(uQSnBM, 0.2)
                end
            end
        end)
        table.insert(GxMLsa, kWcWwx)
    end
end)

TemOpX:NewSlider("Speed Value", "Adjust speed value", 200, 1, function(value)
    xDXXPV = value
end, 1)

-- Flight Toggle with smooth interpolation
xvggGP:NewKeybind("Flight Toggle", "Toggle flight with key", Enum.KeyCode.F, function()
    GbjUbX = not GbjUbX
    if GbjUbX then
        local jIugMa = AshpTz.Character
        if jIugMa then
            local hBtlbh = jIugMa:WaitForChild("Humanoid")
            local OudALc = jIugMa:WaitForChild("HumanoidRootPart")
            local pFKdAa = RunService.RenderStepped:Connect(function()
                if GbjUbX then
                    local uQSnBM = Vector3.new(0, 0, 0)
                    if UserInputService:IsKeyDown(Enum.KeyCode.W) then
                        uQSnBM = uQSnBM + (gPpjzL.CFrame.LookVector * eupSbP)
                    end
                    if UserInputService:IsKeyDown(Enum.KeyCode.S) then
                        uQSnBM = uQSnBM - (gPpjzL.CFrame.LookVector * eupSbP)
                    end
                    if UserInputService:IsKeyDown(Enum.KeyCode.D) then
                        uQSnBM = uQSnBM + (gPpjzL.CFrame.RightVector * eupSbP)
                    end
                    if UserInputService:IsKeyDown(Enum.KeyCode.A) then
                        uQSnBM = uQSnBM - (gPpjzL.CFrame.RightVector * eupSbP)
                    end
                    if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
                        uQSnBM = uQSnBM + Vector3.new(0, eupSbP, 0)
                    end
                    if UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then
                        uQSnBM = uQSnBM - Vector3.new(0, eupSbP, 0)
                    end
                    OudALc.Velocity = OudALc.Velocity:Lerp(uQSnBM, 0.1)
                end
            end)
            table.insert(GxMLsa, pFKdAa)
        end
    end
end)

xvggGP:NewSlider("Flight Speed", "Adjust flight speed", 200, 1, function(value)
    eupSbP = value
end)

-- Clean NoClip toggle using BindToRenderStep and UnbindFromRenderStep for a single connection
aMfoeB:NewToggle("NoClip", "Phase through objects", function(state)
    hXWelD = state
    if hXWelD then
        RunService:BindToRenderStep("NoClip", 100, function()
            if AshpTz.Character then
                for _, part in pairs(AshpTz.Character:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = false
                    end
                end
            end
        end)
    else
        RunService:UnbindFromRenderStep("NoClip")
    end
end)

local function SmoothNoFallDamage()
    if AshpTz.Character then
        local xoxoti = AshpTz.Character:WaitForChild("Humanoid")
        local FKkRAK = AshpTz.Character:WaitForChild("HumanoidRootPart")
        local DYUndZ = xoxoti.StateChanged:Connect(function(_, new)
            if new == Enum.HumanoidStateType.Landed then
                task.wait()
                xoxoti.Health = xoxoti.Health
            end
        end)
        table.insert(GxMLsa, DYUndZ)
        local SyChyK = xoxoti.Health
        local PIcbtO = xoxoti:GetPropertyChangedSignal("Health"):Connect(function()
            if xoxoti.Health < SyChyK then
                local PCOmob = FKkRAK.Velocity
                if PCOmob.Y < -50 then
                    xoxoti.Health = SyChyK
                end
            end
            SyChyK = xoxoti.Health
        end)
        table.insert(GxMLsa, PIcbtO)
    end
end

aMfoeB:NewToggle("No Fall Damage", "Prevents fall damage smoothly", function(state)
    if state then
        SmoothNoFallDamage()
    end
end)

FobjdJ:NewKeybind("Dash", "Press to dash", Enum.KeyCode.Q, function()
    if not ULQIud and AshpTz.Character then
        ULQIud = true
        local FKkRAK = AshpTz.Character:FindFirstChild("HumanoidRootPart")
        if FKkRAK then
            local nnLRtR = Instance.new("BodyVelocity")
            nnLRtR.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
            nnLRtR.Velocity = gPpjzL.CFrame.LookVector * NSZBOf
            nnLRtR.Parent = FKkRAK
            game:GetService("Debris"):AddItem(nnLRtR, 0.2)
            task.wait(1)
            ULQIud = false
        end
    end
end)

FobjdJ:NewSlider("Dash Force", "Adjust dash force", 500, 50, function(value)
    NSZBOf = value
end)

-- Visual Tab for ESP
local NeOnng = JimQGH:NewTab("Visual")
local ZVlbwl = NeOnng:NewSection("ESP")

local function CreateNameESP(player)
    local fhhflF = Instance.new("BillboardGui")
    fhhflF.Name = "NameESP"
    fhhflF.Size = UDim2.new(0, 200, 0, 50)
    fhhflF.AlwaysOnTop = true
    fhhflF.StudsOffset = Vector3.new(0, 2, 0)
    local WSCGNt = Instance.new("TextLabel")
    WSCGNt.Name = "PlayerName"
    WSCGNt.BackgroundTransparency = 1
    WSCGNt.Size = UDim2.new(1, 0, 0, 20)
    WSCGNt.Font = Enum.Font.SourceSansBold
    WSCGNt.TextColor3 = Color3.new(1, 1, 1)
    WSCGNt.TextSize = 14
    WSCGNt.Text = player.Name
    WSCGNt.Parent = fhhflF
    return fhhflF
end

local function UpdateAllESP()
    while OVoMBv do
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= AshpTz then
                if player.Character and player.Character:FindFirstChild("Head") then
                    if GmdpEU[player] then
                        if not player.Character.Head:FindFirstChild("NameESP") then
                            local wMYyRc = CreateNameESP(player)
                            GmdpEU[player] = wMYyRc
                            wMYyRc.Parent = player.Character.Head
                        end
                    end
                    if player.Character:FindFirstChild("Humanoid") then
                        local dGrIKf = player.Character:FindFirstChild("ESP_Highlight")
                        if dGrIKf then
                            local zqLGjk = player.Character.xoxoti.Health
                            local ATVvMa = player.Character.xoxoti.MaxHealth
                            local JAOlMI = zqLGjk / ATVvMa
                            dGrIKf.FillColor = Color3.new(1 - JAOlMI, JAOlMI, 0)
                        end
                    end
                    if qWRmtT[player] then
                        if not player.Character:FindFirstChild("Highlight") then
                            local dGrIKf = Instance.new("Highlight")
                            dGrIKf.FillTransparency = 0.5
                            dGrIKf.OutlineTransparency = 0
                            dGrIKf.FillColor = bGuZKS
                            dGrIKf.OutlineColor = Color3.new(1, 1, 1)
                            dGrIKf.Parent = player.Character
                            qWRmtT[player] = dGrIKf
                        end
                    end
                end
            end
        end
        task.wait(0.1)
    end
end

ZVlbwl:NewToggle("Name ESP", "Shows player names", function(state)
    if state then
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= AshpTz and player.Character then
                local wMYyRc = CreateNameESP(player)
                GmdpEU[player] = wMYyRc
                wMYyRc.Parent = player.Character:WaitForChild("Head")
            end
        end
    else
        for _, wMYyRc in pairs(GmdpEU) do
            wMYyRc:Destroy()
        end
        GmdpEU = {}
    end
end)

ZVlbwl:NewToggle("Health ESP", "Shows health-based highlights", function(state)
    if state then
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= AshpTz and player.Character then
                local dGrIKf = Instance.new("Highlight")
                dGrIKf.Name = "ESP_Highlight"
                dGrIKf.Parent = player.Character
            end
        end
    else
        for _, player in ipairs(Players:GetPlayers()) do
            if player.Character then
                local dGrIKf = player.Character:FindFirstChild("ESP_Highlight")
                if dGrIKf then dGrIKf:Destroy() end
            end
        end
    end
end)

ZVlbwl:NewColorPicker("ESP Color", "Pick custom ESP color", Color3.new(1, 0, 0), function(color)
    bGuZKS = color
    for _, dGrIKf in pairs(qWRmtT) do
        dGrIKf.FillColor = color
    end
end)

ZVlbwl:NewToggle("Custom ESP", "Shows custom color highlights", function(state)
    if state then
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= AshpTz and player.Character then
                local dGrIKf = Instance.new("Highlight")
                dGrIKf.FillTransparency = 0.5
                dGrIKf.OutlineTransparency = 0
                dGrIKf.FillColor = bGuZKS
                dGrIKf.OutlineColor = Color3.new(1, 1, 1)
                dGrIKf.Parent = player.Character
                qWRmtT[player] = dGrIKf
            end
        end
    else
        for _, dGrIKf in pairs(qWRmtT) do
            dGrIKf:Destroy()
        end
        qWRmtT = {}
    end
end)

ZVlbwl:NewToggle("Stop ESP Updates", "Stops all ESP updates", function(state)
    OVoMBv = not state
    if OVoMBv then
        task.spawn(UpdateAllESP)
    end
end)

-- Settings Tab
local IxPmYw = JimQGH:NewTab("Settings")
local OIyFJg = IxPmYw:NewSection("GUI Settings")

OIyFJg:NewDropdown("Theme", "Change UI Theme", {
    "DarkTheme",
    "LightTheme",
    "BloodTheme",
    "GrapeTheme",
    "Ocean",
    "Midnight",
    "Sentinel",
    "Synapse"
}, function(currentTheme)
    hJvXJe:ChangeTheme(currentTheme)
end)

OIyFJg:NewKeybind("Toggle GUI", "Shows/Hides the GUI", Enum.KeyCode.RightShift, function()
    hJvXJe:ToggleUI()
end)

local function unloadScript()
    for _, con in ipairs(GxMLsa) do
        pcall(function() con:Disconnect() end)
    end
    GxMLsa = {}
    OVoMBv = false
    for _, wMYyRc in pairs(GmdpEU) do
        if wMYyRc and wMYyRc.Destroy then
            pcall(function() wMYyRc:Destroy() end)
        end
    end
    GmdpEU = {}
    for _, dGrIKf in pairs(qWRmtT) do
        if dGrIKf and dGrIKf.Destroy then
            pcall(function() dGrIKf:Destroy() end)
        end
    end
    qWRmtT = {}
    if JimQGH and JimQGH.Destroy then
        pcall(function() JimQGH:Destroy() end)
    end
    print("Script unloaded successfully.")
end

OIyFJg:NewButton("Unload Script", "Unload all changes and close the GUI", unloadScript)

task.spawn(UpdateAllESP)

Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function(character)
        if GmdpEU[player] then
            local wMYyRc = CreateNameESP(player)
            GmdpEU[player] = wMYyRc
            wMYyRc.Parent = character:WaitForChild("Head")
        end
    end)
end)

Players.PlayerRemoving:Connect(function(player)
    if GmdpEU[player] then
        pcall(function() GmdpEU[player]:Destroy() end)
        GmdpEU[player] = nil
    end
    if qWRmtT[player] then
        pcall(function() qWRmtT[player]:Destroy() end)
        qWRmtT[player] = nil
    end
end)


